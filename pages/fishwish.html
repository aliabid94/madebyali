<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fishwish - madebyali</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link href="/static/styles.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: "Montserrat", sans-serif;
        }
    </style>
</head>

<body class="fishwish min-h-screen flex flex-col items-center w-full">
    <nav class="container px-4 flex mt-4 justify-between items-center w-full">
        <a href="/"><img src="/static/logo.png" class="h-6"></a>
        <h1 class="text-md text-center">fishwish - <span id="date"></span>puzzle</h1>
        <button id="howToPlayBtn" class="outline-none hover:underline">how to play</button>
    </nav>
    <main class="container px-4 grow">
        <div id="cards" class="card-grid mb-4 relative">
            <div class="card">
                <div class="clue"></div>
                <div class="answer"></div>
            </div>
            <div class="card">
                <div class="clue"></div>
                <div class="answer"></div>
            </div>
            <div class="card">
                <div class="clue"></div>
                <div class="answer"></div>
            </div>
            <div class="card">
                <div class="clue"></div>
                <div class="answer"></div>
            </div>
            <div class="card">
                <div class="clue"></div>
                <div class="answer"></div>
            </div>
            <div class="card">
                <div class="clue"></div>
                <div class="answer"></div>
            </div>
            <div class="card">
                <div class="clue"></div>
                <div class="answer"></div>
            </div>
            <div class="card">
                <div class="clue"></div>
                <div class="answer"></div>
            </div>
        </div>
        <div class="grid grid-cols-2 gap-8">
            <input type="text" placeholder="left clue" autofocus class="rounded border-4 border-gray-100 p-4">
            <input type="text" placeholder="right clue" class="rounded border-4 border-gray-100 p-4">
        </div>
    </main>

    <div id="instructionsModal" class="fixed inset-0 bg-black bg-opacity-50 items-center justify-center hidden z-50">
        <div class="bg-white rounded p-6 min-w-80 max-w-md max-h-full overflow-y-auto mx-4 relative text-sm">
            <button id="closeModal"
                class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
            <h2 class="text-lg mb-4">how to play fishwish</h2>
            <p>Each card is a clue representing a secret word. Each of the secret words on the left column has a
                rhyming pair in the right column. The objective is uncover all the rhyming pairs.</p>
            <p>Let's take a look at an example with 2 cards on each side.</p>
            <div class="card-grid sm mb-3">
                <div class="card">
                    <div class="clue">e.g. the DMZ, or Berlin Wall</div>
                    <div class="answer hidden">border</div>
                </div>
                <div class="card">
                    <div class="clue">You get 3 (no asking for more!)</div>
                    <div class="answer hidden">wish</div>
                </div>
                <div class="card">
                    <div class="clue">Suspicious with a y?</div>
                    <div class="answer hidden">fish</div>
                </div>
                <div class="card">
                    <div class="clue">1st, 2nd, then 3rd.</div>
                    <div class="answer hidden">order</div>
                </div>
            </div>
            <p>On their own, the clues may seem quite vague, but given that there is a rhyming pair in the other column
                helps narrow options.</p>
            <p>The first card of the left might be "divide" or "border". The last clue on the right could be "rank" or
                "order". We can identify a rhyming pair here - "border order"! You would enter this in the input
                textboxes.</p>
            <p>Can you identify the other rhyming pair here?</p>
        </div>
    </div>

    <footer class="w-full h-32 relative">
        <div class="absolute h-full w-full"
            style="background-image: url('/static/island/middle.png'); background-size: auto 128px;"></div>
        <img class="absolute left-0 h-full" src='/static/island/left.png' />
        <img class="absolute right-0 h-full" src='/static/island/right.png' />
    </footer>

    <script>
        const modal = document.getElementById('instructionsModal');
        const howToPlayBtn = document.getElementById('howToPlayBtn');
        const closeModalBtn = document.getElementById('closeModal');

        function showModal() {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function hideModal() {
            modal.classList.remove('flex');
            modal.classList.add('hidden');
        }

        if (!localStorage.getItem('fishwish-visited')) {
            showModal();
            localStorage.setItem('fishwish-visited', 'true');
        }

        howToPlayBtn.addEventListener('click', showModal);
        closeModalBtn.addEventListener('click', hideModal);

        modal.addEventListener('click', function (e) {
            if (e.target === modal) {
                hideModal();
            }
        });

        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                hideModal();
            }
        });
    </script>
    <script>

        const firstInput = document.querySelector('input[type="text"]');
        const secondInput = document.querySelectorAll('input[type="text"]')[1];

        firstInput.addEventListener('keydown', function (e) {
            if (e.key === ' ') {
                e.preventDefault();
                secondInput.focus();
            }
            if (e.key === 'Enter') {
                submit();
            }
        });

        secondInput.addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                submit();
            }
        });

        const game = {
            left: [
                ["e.g. the DMZ, or Berlin Wall", "border"],
                ["Suspicious with a y?", "fish"],
                ["Not quite dark", "light"],
                ["A flying mammal", "bat"]
            ], right: [
                ["You get 3 (no asking for more!)", "wish"],
                ["Opposite of day", "night"],
                ["1st, 2nd, then 3rd.", "order"],
                ["Ozempic ended this", "fat"]
            ], match_order: [2, 0, 1, 3]
        };
        let solved = [];

        function startGame() {
            const cardsContainer = document.getElementById('cards');
            for (let i = 0; i < game.left.length; i++) {
                const leftCard = cardsContainer.children[i * 2];
                const rightCard = cardsContainer.children[i * 2 + 1];

                leftCard.querySelector('.clue').textContent = game.left[i][0];
                leftCard.querySelector('.answer').textContent = game.left[i][1];

                rightCard.querySelector('.clue').textContent = game.right[i][0];
                rightCard.querySelector('.answer').textContent = game.right[i][1];
            }
        }
        startGame();

        function clearLines() {
            document.querySelectorAll('svg').forEach(svg => svg.remove());
        }

        function drawLines() {
            for (const left of solved) {
                const right = game.match_order[left];
                const from = document.querySelector(`#cards .card:nth-child(${left * 2 + 1})`);
                const to = document.querySelector(`#cards .card:nth-child(${right * 2 + 2})`);

                const fromRect = from.getBoundingClientRect();
                const toRect = to.getBoundingClientRect();

                const fromCenter = {
                    x: fromRect.right - 4,
                    y: fromRect.top + fromRect.height / 2
                };

                const toCenter = {
                    x: toRect.left + 4,
                    y: toRect.top + toRect.height / 2
                };

                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');

                let stroke_color;
                let bg_color;
                if (left === 0) {
                    stroke_color = "stroke-red-500";
                    bg_color = "bg-red-500";
                } else if (left === 1) {
                    stroke_color = "stroke-green-500";
                    bg_color = "bg-green-500";
                } else if (left === 2) {
                    stroke_color = "stroke-blue-500";
                    bg_color = "bg-blue-500";
                } else if (left === 3) {
                    stroke_color = "stroke-yellow-500";
                    bg_color = "bg-yellow-500";
                }

                svg.style.position = 'absolute';
                svg.style.top = '0';
                svg.style.left = '0';
                svg.style.width = '100vw';
                svg.style.height = '100vh';
                svg.style.pointerEvents = 'none';
                svg.style.zIndex = '-1';

                line.classList.add(stroke_color);
                line.setAttribute('x1', fromCenter.x);
                line.setAttribute('y1', fromCenter.y);
                line.setAttribute('x2', toCenter.x);
                line.setAttribute('y2', toCenter.y);
                line.setAttribute('stroke-linecap', 'round');
                line.setAttribute('stroke-width', '8');

                svg.appendChild(line);
                from.classList.add(bg_color);
                from.classList.add('solved');
                to.classList.add(bg_color);
                to.classList.add('solved');
                document.body.appendChild(svg);
            }
        }

        drawLines();

        function submit() {
            const leftEntry = firstInput.value.trim().toLowerCase();
            const rightEntry = secondInput.value.trim().toLowerCase();

            if (!leftEntry || !rightEntry) return;

            let leftIndex = -1;
            let rightIndex = -1;

            for (let i = 0; i < game.left.length; i++) {
                if (game.left[i][1].toLowerCase() === leftEntry) {
                    leftIndex = i;
                    break;
                }
            }

            for (let i = 0; i < game.right.length; i++) {
                if (game.right[i][1].toLowerCase() === rightEntry) {
                    rightIndex = i;
                    break;
                }
            }

            if (leftIndex !== -1 && rightIndex !== -1 &&
                game.match_order[leftIndex] === rightIndex &&
                !solved.includes(leftIndex)) {

                solved.push(leftIndex);
                firstInput.value = '';
                secondInput.value = '';
                firstInput.focus();
                clearLines();
                drawLines();
            } else {
                // Invalid match - vibrate textboxes
                vibrateTextboxes();
            }
        }

        function vibrateTextboxes() {
            const vibrationKeyframes = [
                { transform: 'translateX(0px)' },
                { transform: 'translateX(-10px)' },
                { transform: 'translateX(10px)' },
                { transform: 'translateX(-10px)' },
                { transform: 'translateX(10px)' },
                { transform: 'translateX(0px)' }
            ];

            const vibrationOptions = {
                duration: 400,
                easing: 'ease-in-out'
            };

            firstInput.animate(vibrationKeyframes, vibrationOptions);
            secondInput.animate(vibrationKeyframes, vibrationOptions);
        }

        window.addEventListener('resize', function () {
            clearLines();
            drawLines();
        });

    </script>
    <script>
        const dateSpan = document.getElementById('date');
        const today = new Date();
        const months = ['jan', 'feb', 'mar', 'apr', 'may', 'jun',
                       'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];
        const formattedDate = months[today.getMonth()] + ' ' + today.getDate();
        dateSpan.textContent = formattedDate + ' ';
    </script>
</body>

</html>